##
# Valid environment variables
#MYSQL_ROOT_PASSWORD
#MYSQL_BACKUP_USER MYSQL_BACKUP_PASS
#MYSQL_DATABASE
#MYSQL_USER MYSQL_PASSWORD
#MYSQL_MASTER_SERVER MYSQL_MASTER_PORT MYSQL_REPLICA_USER MYSQL_REPLICA_PASS
#MYSQL_MASTER_WAIT_TIME
#MYSQL_MASTER_ROOT_PASS MYSQL_SETUP_WAIT_TIME

#
# Run a master and a slave server with GTID enabled:
#  - expose local mysql-utilities code;
#  - expose docker socket to fabric (not for swarm);
fabric:
  image: ioggstream/mysql-community
  hostname: fabric
  environment:
    - MYSQL_ROOT_PASSWORD=root
    - MYSQL_REPLICA_USER=repl
    - MYSQL_REPLICA_PASS=repl
    - MYSQL_USER=fabric
    - MYSQL_PASS=fabric
    - MYSQL_DATABASE=sample
  entrypoint: /code/docker-entrypoint.sh
  volumes:
    - ./:/code
    - /var/run/docker.sock:/var/run/docker.sock
  command: ['mysqld', '--defaults-file=/code/my-gtid.cnf',  '--binlog-format=row',
   '--innodb-buffer-pool-size=10M', '--explicit-defaults-for-timestamp']
  

master:
  image: ioggstream/mysql-community
  hostname: m
  environment:
    - MYSQL_ROOT_PASSWORD=root
    - MYSQL_REPLICA_USER=repl
    - MYSQL_REPLICA_PASS=repl
    - MYSQL_USER=fabric
    - MYSQL_PASS=fabric
    - MYSQL_DATABASE=sample
  entrypoint: /code/docker-entrypoint.sh
  volumes:
    - ./:/code
  command: ['mysqld', '--defaults-file=/code/my-gtid.cnf',  '--binlog-format=row',
    '--innodb-buffer-pool-size=10M',
    ]
  
  
slave:
  image: ioggstream/mysql-community
  environment:
    - MYSQL_ROOT_PASSWORD=root
    - MYSQL_REPLICA_USER=repl
    - MYSQL_REPLICA_PASS=repl
    - MYSQL_USER=fabric
    - MYSQL_PASS=fabric
    - MYSQL_DATABASE=sample
  entrypoint: /code/docker-entrypoint.sh
  links:
    - master
  volumes:
    - ./:/code
  command: ['mysqld', '--defaults-file=/code/my-gtid.cnf',  '--binlog-format=row',
    '--innodb-buffer-pool-size=10M']

